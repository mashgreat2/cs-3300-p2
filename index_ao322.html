<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- Use bootstrap for some minimal styling-->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <title>Project 2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--Import d3-->
  <!--<script src="https://d3js.org/d3.v5.min.js"></script>-->
  <script src="./d3.v5.min.js"></script>
  <script src="./topojson.v2.min.js"></script>
  <style>
    .grid line {
      stroke: lightgrey;
      stroke-opacity: 0.8;
    }
    .state , .state_2 {
      fill: white;
      stroke: black;
    }



    g.x text {
      font-size: 7.5px;
    }
  </style>
</head>

<body style="background-color: #dddddd;">
<div class="container">
  <div class="card mx-auto  my-2" style="width: 900px;">
    <h4 class="card-header">INFO 3300 - Project 2</h4>
    <div class="card-body">
      <p>Project by:</p>
      <ul>
        <li>By SM Mashuque, (sm2344)</li>
        <li>By Anstasia Okoye, (ao322)</li>
        <li>By x, (x)</li>
      </ul>
    </div>
  </div>

  <div class="card mx-auto  my-2" style="width: 900px;">
    <h4 class="card-header">Gun violence data</h4>
    <div class="card-body">
      <h5>Lorem ipsum dolor sit amet consectetur adipisicing elit. Neque, quidem natus, dicta eveniet perspiciatis dolorum temporibus laboriosam dolor reprehenderit ratione, modi veritatis quisquam eius numquam repellat officiis labore enim nam?</h5>
      <div id="p1_div_for_svg">
      </div>
      <div id="p1_div_for_legend">
      </div>
      <br>
      <p>
        Lorem ipsum dolor sit amet, consectetur adipisicing elit. A corporis at neque itaque maiores, odio nesciunt error iusto dolore vero, eos quae doloribus possimus, obcaecati in quis illo non! Consequuntur!
      </p>
    </div>
  </div>


</div>

<script>
  // Code for Graph One
  var svg_width = 800;
  var svg_height = 500;
  var margin = { top: 30, right: 30, bottom: 50, left: 60};
  var education_data = null;
  var data_filtered = {};
  var valid_data = {};

  async function draw_graph() {

    d3.select("#p1_div_for_svg")
      .append("svg")
      .attr("width", svg_width).attr("height", svg_height)
      .attr("id", "p1_svg")
      .append("g").attr("id", "p1_svg_g1");

    var svg = d3.select('#p1_svg_g1');

    // load the state TopoJSON data
    let states_topo = await d3.json("./us-map-data/us.json");
    // convert the TopoJSON to GeoJson
    let states_geo = topojson.feature(states_topo, states_topo.objects.states);
    // D3 Projection
    let projection = d3.geoAlbersUsa().fitSize([svg_width, svg_height], states_geo);
    let path = d3.geoPath().projection(projection);

    var state_name_IDs = await d3.tsv("../us-map-data/us-state-names.tsv");

    svg.selectAll("path")
      .data(states_geo.features)
      .enter()
      .append("path")
      .attr("class","state")
      .attr("d", path)
      .attr("state_id", data => data.id)
      .attr("state_name", data => get_state_name(data.id, state_name_IDs));

    svg.selectAll("text")
      .data(states_geo.features)
      .enter()
      .append("svg:text")
      .text(data => get_state_name(data.id, state_name_IDs, short=true))
      .attr("x", d => path.centroid(d)[0])
      .attr("y", d => path.centroid(d)[1])
      .attr("text-anchor","middle")
      .attr('font-size','13px');


    education_data = null;

    // setup objects for each state.

    const color_scale = d3.scaleSequential(d3.interpolateOranges).domain([0,1]);

    svg.selectAll(".state")
      .style("fill", data => {
        let state_name = get_state_name(data.id, state_name_IDs);
        // console.log("data: ", data);
        // console.log("state_name: ", state_name);
        if(valid_data[state_name] === undefined) {return color_scale(0);}
        let score = valid_data[state_name].scaled_score;
        return color_scale(score*20)
      });

  }

  draw_graph();

  clean_name = (name) => {
    let cleaned_name = name.replace(/[ ]/g, "_");
    return cleaned_name.toLowerCase().replace(/[ \-,.:'()&#!?]/g, "")
  };

  get_state_name = (id, state_name_IDs, short=false) => {
    let temp = state_name_IDs.filter(state => {
      return Number(state.id) === id;
    });
    if (short) return temp[0].code;
    return clean_name(temp[0].name);
  };

</script>

</body>

</html>
